<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>WizzLists</title>
  <style>
    body { font-family: system-ui, sans-serif; max-width: 720px; margin: 40px auto; padding: 0 16px; }
    label { display:block; margin: 12px 0 6px; }
    input, button { padding: 10px; font-size: 16px; width: 100%; max-width: 480px; }
    ol { padding-left: 20px; }
    .row { margin: 8px 0; }
    .meta { margin-top: 12px; color: #555; font-size: 14px; }
  </style>
</head>
<body>
  <h1>WizzLists ✨</h1>
  <p>Try: <em>US presidents</em> sorted by <em>height</em>, length <em>10</em>.</p>

  <div class="row">
    <label>Subject</label>
    <input id="subject" value="US presidents" placeholder="e.g., dog breeds, countries, GoT characters"/>
  </div>

  <div class="row">
  <label>Sort by</label>
  <div style="display:flex; gap:12px; align-items:center; margin:6px 0 10px;">
    <label><input type="radio" name="sortmode" value="custom" checked> Custom</label>
    <label><input type="radio" name="sortmode" value="alphabetical"> Alphabetical</label>
    <label><input type="radio" name="sortmode" value="random"> Random</label>
  </div>
  <input id="sortBy" value="height" placeholder="e.g., height, eye colour, chronological" />
</div>


  <div class="row">
    <label>List Length (Maximum 25)</label>
    <input id="length" type="number" value="10" min="1" max="25"/>
  </div>

  <div class="row">
    <button id="go">Generate</button>
  </div>

  <div id="out"></div>

  <script>
  const $ = (id) => document.getElementById(id);
  const sortByInput = $("sortBy");
  const modes = Array.from(document.querySelectorAll('input[name="sortmode"]'));

  function updateSortUI() {
    const v = document.querySelector('input[name="sortmode"]:checked').value;
    const isCustom = v === "custom";
    sortByInput.disabled = !isCustom;
    sortByInput.style.opacity = isCustom ? "1" : "0.6";
  }
  modes.forEach(r => r.addEventListener("change", updateSortUI));
  updateSortUI();

  function currentSortBy() {
    const v = document.querySelector('input[name="sortmode"]:checked').value;
    if (v === "alphabetical" || v === "random") return v;
    return sortByInput.value.trim();
  }

  function clampLength(n) {
    const x = Math.trunc(Number(n) || 10);
    return Math.max(1, Math.min(x, 25));
  }

  function renderOutput(data) {
    const isBasic = ["alphabetical","random","chronological"].includes(String(data?.meta?.sort_used || "").toLowerCase());
    const itemsHtml = (data.items || []).map(i => {
      const name = i?.name ?? "";
      let extra = "";
      if (!isBasic) {
        const parts = [];
        if (i?.attr) parts.push(i.attr);
        if (i?.tier) parts.push(`tier: ${i.tier}`);
        if (typeof i?.confidence === "number") parts.push(`conf: ${i.confidence.toFixed(2)}`);
        if (parts.length) extra = ` — <small>${parts.join(" • ")}</small>`;
      }
      return `<li><strong>${name}</strong>${extra}</li>`;
    }).join("");

    const sources = (data?.meta?.sources || []).map(s => `<li>${s}</li>`).join("");
    const notes = (data?.meta?.notes || []).map(n => `<li>${n}</li>`).join("");

    $("out").innerHTML = `
      <ol>${itemsHtml}</ol>
      <div class="meta">Sorted by: ${data.meta.sort_used} • Length: ${data.meta.length}</div>
      ${(sources || notes) ? `
        <div class="meta">
          ${sources ? `<div><strong>Sources</strong><ul>${sources}</ul></div>` : ""}
          ${notes ? `<div><strong>Notes</strong><ul>${notes}</ul></div>` : ""}
        </div>` : ""}
    `;
  }

  async function generate() {
    const subject = $("subject").value.trim();
    const sort_by = currentSortBy();
    const length = clampLength($("length").value);

    if (!subject) {
      $("out").textContent = "Please enter a subject.";
      return;
    }

    const body = { subject, sort_by, length };
    $("out").textContent = "Loading…";
    $("go").disabled = true;

    try {
      const r = await fetch("/api/generate", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(body)
      });
      if (!r.ok) {
        const txt = await r.text().catch(() => "");
        throw new Error(`HTTP ${r.status} ${txt.slice(0,120)}`);
      }
      const data = await r.json();
      if (!data?.items) throw new Error("Invalid response shape");
      renderOutput(data);
    } catch (e) {
      console.error(e);
      $("out").textContent = "Something went wrong.";
    } finally {
      $("go").disabled = false;
    }
  }

  $("go").onclick = generate;
  // Press Enter in any input to run
  ["subject","sortBy","length"].forEach(id => {
    $(id).addEventListener("keydown", (ev) => {
      if (ev.key === "Enter") generate();
    });
  });
</script>
</body>
</html>
